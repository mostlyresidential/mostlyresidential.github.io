---
layout: post
title:  "Mostly Residential"
date:   2024-03-16 06:24:14 -0400
categories: jekyll update
---

{% highlight ruby %}
sudo apt update
sudo apt install --no-install-recommends git cmake ninja-build gperf \
ccache dfu-util device-tree-compiler wget python3-dev python3-pip \
python3-setuptools python3-tk python3-venv python3-wheel xz-utils file \
make gcc gcc-multilib g++-multilib libsdl2-dev cmake
{% endhighlight %}

---

{% highlight ruby %}
wget -c https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.16.5-1/zephyr-sdk-0.16.5-1_linux-x86_64.tar.xz
tar xvf zephyr-sdk-0.16.5-1_linux-x86_64.tar.xz
cd zephyr-sdk-0.16.5-1
./setup.sh
{% endhighlight %}

# OPTIONAL
{% highlight ruby %}
sudo cp ~/zephyr-sdk-0.16.5-1/sysroots/x86_64-pokysdk-linux/usr/share/openocd/contrib/60-openocd.rules /etc/udev/rules.d
sudo udevadm control --reload
{% endhighlight %}

{% highlight ruby %}
mkdir ~/golioth-firmware-sdk
python3 -m venv ~/golioth-firmware-sdk/.venv
source ~/golioth-firmware-sdk/.venv/bin/activate
{% endhighlight %}


{% highlight ruby %}
pip3 install wheel
pip3 install west
{% endhighlight %}


{% highlight ruby %}
west init -m https://github.com/golioth/golioth-firmware-sdk.git --mf west-zephyr.yml ~/golioth-firmware-sdk
cd ~/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk
west update
{% endhighlight %}


#  Intercepted and reouted
{% highlight ruby %}
Receiving objects:  14% (137425/981607), 98.43 MiB | 2.97 MiB/s
Receiving objects:  26% (258112/981607), 229.89 MiB | 1.87 MiB/s
error: RPC failed; curl 92 HTTP/2 stream 5 was not closed cleanly: CANCEL (err 8)
error: 2148 bytes of body are still expected
fetch-pack: unexpected disconnect while reading sideband packet
fatal: early EOF
fatal: fetch-pack: invalid index-pack output
FATAL ERROR: command exited with status 128: fetch -f --tags -- https://gi
{% endhighlight %}

{% highlight ruby %}
west update
{% endhighlight %}

# Master branch magic for all modules
{% highlight ruby %}
HEAD is now at 38573af B91 ADC driver support
HEAD is now at 38573af B91 ADC driver support

HEAD is now at b85f86e simplelink: slnetsock: fix sys/time.h include when sockets are enabled
HEAD is now at b85f86e simplelink: slnetsock: fix sys/time.h include when sockets are enabled

HEAD is now at e5bcb2e Update WE sensors SDK to version 2.5.0
HEAD is now at e5bcb2e Update WE sensors SDK to version 2.5.0

HEAD is now at 08325d6 zephyr: change SoC overlay name from nxp_imx8 to nxp_imx_adsp
HEAD is now at 08325d6 zephyr: change SoC overlay name from nxp_imx8 to nxp_imx_adsp
{% endhighlight %}

{% highlight ruby %}
git submodule update --init --recursive
{% endhighlight %}

# Another Network drop
{% highlight ruby %}
=== updating zcbor (modules/lib/zcbor):
--- zcbor: initializing
Initialized empty Git repository in /home/user/golioth-firmware-sdk/modules/lib/zcbor/.git/
--- zcbor: fetching, need revision d3093b5684f62268c7f27f8a5079f166772619de
remote: Enumerating objects: 5228, done.
remote: Counting objects: 100% (1134/1134), done.
remote: Compressing objects: 100% (376/376), done.
remote: Total 5228 (delta 835), reused 828 (delta 740), pack-reused 4094
Receiving objects: 100% (5228/5228), 1.61 MiB | 797.00 KiB/s, done.
Resolving deltas: 100% (3102/3102), done.
From https://github.com/zephyrproject-rtos/zcbor
 * [new branch]      main              -> refs/west/main
 * [new branch]      release/0.6.1     -> refs/west/release/0.6.1
 * [new branch]      release/0.8.2     -> refs/west/release/0.8.2
 * [new tag]         0.1.0             -> 0.1.0
 * [new tag]         0.2.0             -> 0.2.0
 * [new tag]         0.3.0             -> 0.3.0
 * [new tag]         0.3.1             -> 0.3.1
 * [new tag]         0.4.0             -> 0.4.0
 * [new tag]         0.5.0             -> 0.5.0
 * [new tag]         0.5.1             -> 0.5.1
 * [new tag]         0.6.0             -> 0.6.0
 * [new tag]         0.8.0             -> 0.8.0
 * [new tag]         0.8.1             -> 0.8.1
 * [new tag]         deprecated-master -> deprecated-master
 * [new tag]         inital-pr         -> inital-pr
 * [new tag]         old-structure     -> old-structure
HEAD is now at d3093b5 Update version from 0.8.99 to 0.8.1
HEAD is now at d3093b5 Update version from 0.8.99 to 0.8.1
ERROR: update failed for project hal_espressif
{% endhighlight %}

{% highlight ruby %}
west update
{% endhighlight %}

# Again
{% highlight ruby %}
=== updating uoscore-uedhoc (modules/lib/uoscore-uedhoc):
HEAD is now at 150f4eb [zephyr fromlist] Adapt to changes in name generation in zcbor 0.8.0
=== updating zcbor (modules/lib/zcbor):
HEAD is now at d3093b5 Update version from 0.8.99 to 0.8.1
ERROR: update failed for project hal_espressif
{% endhighlight %}

{% highlight ruby %}
west update
=== updating zephyr (zephyr):
HEAD is now at 468eb56cf2 release: Zephyr v3.6.0
=== updating acpica (modules/lib/acpica):
HEAD is now at da5f2721e Merge pull request #905 from najumon1980/acpi_timer                                                  
=== updating cmsis (modules/hal/cmsis):
HEAD is now at 4b96cbb doc: Update documentations for CMSIS 5.9.0
{% endhighlight %}

{% highlight ruby %}
west update
HEAD is now at 0b898c9b7 Platform: nxp: Add initialization flag to the CMSIS USART driver.
=== updating trusted-firmware-a (modules/tee/tf-a/trusted-firmware-a):
HEAD is now at 421dc0502 Merge pull request #3 from SgrrZhf/topics/huizha01/2.9.0-updates                                     
=== updating uoscore-uedhoc (modules/lib/uoscore-uedhoc):
HEAD is now at 150f4eb [zephyr fromlist] Adapt to changes in name generation in zcbor 0.8.0
=== updating zcbor (modules/lib/zcbor):
HEAD is now at d3093b5 Update version from 0.8.99 to 0.8.1
ERROR: update failed for project hal_espressif
{% endhighlight %}


{% highlight ruby %}
west update
=== updating hal_ambiq (modules/hal/ambiq):
HEAD is now at ff4ca35 Stimer: remove disabling stmer's COMPARE interrupts in delta_set() api
=== updating hal_atmel (modules/hal/atmel):
HEAD is now at aad79bf qdec: SAME70b: Fix missing TC_CMR definitions
=== updating hal_espressif (modules/hal/espressif):
--- hal_espressif: fetching, need revision 67fa60bdffca7ba8ed199aecfaa26f485f24878b
remote: Enumerating objects: 305873, done.
remote: Counting objects: 100% (305872/305872), done.
remote: Compressing objects: 100% (64400/64400), done.
Receiving objects:  82% (252685/305873), 43.82 MiB | 1.61 MiB/s
remote: Total 305873 (delta 229179), reused 305271 (delta 229090), pack-reused 1
Receiving objects: 100% (305873/305873), 164.96 MiB | 2.10 MiB/s, done.
Resolving deltas: 100% (229179/229179), done.
.
.
.
=== updating zcbor (modules/lib/zcbor):
HEAD is now at d3093b5 Update version from 0.8.99 to 0.8.1
{% endhighlight %}

{% highlight ruby %}
west zephyr-export
{% endhighlight %}

{% highlight ruby %}
cd ~/golioth-firmware-sdk
pip3 install -r  zephyr/scripts/requirements.txt
{% endhighlight %}

{% highlight ruby %}
export ZEPHYR_TOOLCHAIN_VARIANT=zephyr
export ZEPHYR_SDK_INSTALL_DIR=~/zephyr-sdk-0.16.5-1
{% endhighlight %}

{% highlight ruby %}
cd ~/golioth-firmware-sdk/tools/net-tools
make
{% endhighlight %}

{% highlight ruby %}
{% endhighlight %}



{% highlight ruby %}
cd /home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello
west build -b qemu_x86 . -p
west build -t run
{% endhighlight %}

{% highlight ruby %}
cd ~/golioth-firmware-sdk/tools/net-tools
./loop-socat.sh
sudo ./loop-slip-tap.sh
{% endhighlight %}

# Run seperately or background find easter egg
{% highlight ruby %}
~/golioth-firmware-sdk/tools/net-tools/loop-slip.sh
~/golioth-firmware-sdk/tools/net-tools/loop-slip-tap.sh


tap0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.0.2.2  netmask 255.255.255.0  broadcast 0.0.0.0
        inet6 2001:db8::2  prefixlen 64  scopeid 0x0<global>
        inet6 fe80::64c1:98ff:fe17:4be  prefixlen 64  scopeid 0x20<link>
        ether 66:c1:98:17:04:be  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0


0

�;!�����33��f�����` :�����c���d����������g�33f�����`8��d������:�i�������33f�����`:���d�������xf����33f�����`8��d������:�i�������33f�����`:���d�������xf����^�f��ED<�@�!������0��
                                                 _googlecast_tcplocal
                                                                     �^�f��ED<�@� ������0��
                                                                                           _googlecast_tcplocal
                                                                                                               �^f��F��(@A�����"����^f��F��(@A�����"����^�f��ED=D@�g������0��
                                              _googlecast_tcplocal
                                                                  �^�f��ED=E@�f������0��
                                                                                        _googlecast_tcplocal
                                                                                                            �^�f��ED>�@�������0��
  _googlecast_tcplocal
                      �^�f��ED>�@�������0��
                                           _googlecast_tcplocal
                                                               �33f�����`:���d�������xf����
Segmentation fault
can't open siodev ``/tmp/slip.dev''
{% endhighlight %}

{% highlight ruby %}
cd /home/user/golioth-firmware-sdk/zephyr/samples/net/sockets/echo_server
west build -b qemu_x86 . -- -DCONF_FILE="prj.conf overlay-capture.conf"
{% endhighlight %}

{% highlight ruby %}
┌──(.venv)─(user㉿none)-[~/…/golioth-firmware-sdk/examples/zephyr/hello]
└─$ cd /home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello
┌──(.venv)─(user㉿none)-[~/…/golioth-firmware-sdk/examples/zephyr/hello]
└─$ west build -b qemu_x86 . -p
-- west build: generating a build system
Loading Zephyr default modules (Zephyr base).
-- Application: /home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello
-- CMake version: 3.28.3
-- Found Python3: /home/user/golioth-firmware-sdk/.venv/bin/python3 (found suitable version "3.11.8", minimum required is "3.8") found components: Interpreter 
-- Cache files will be written to: /home/user/.cache/zephyr
-- Zephyr version: 3.6.0 (/home/user/golioth-firmware-sdk/zephyr)
-- Found west (found suitable version "1.2.0", minimum required is "0.14.0")
-- Board: qemu_x86
-- Found host-tools: zephyr 0.16.5 (/home/user/zephyr-sdk-0.16.5-1)
-- Found toolchain: zephyr 0.16.5 (/home/user/zephyr-sdk-0.16.5-1)
-- Found Dtc: /home/user/zephyr-sdk-0.16.5-1/sysroots/x86_64-pokysdk-linux/usr/bin/dtc (found suitable version "1.6.0", minimum required is "1.4.6") 
-- Found BOARD.dts: /home/user/golioth-firmware-sdk/zephyr/boards/x86/qemu_x86/qemu_x86.dts
-- Generated zephyr.dts: /home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello/build/zephyr/zephyr.dts
-- Generated devicetree_generated.h: /home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello/build/zephyr/include/generated/devicetree_generated.h
-- Including generated dts.cmake file: /home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello/build/zephyr/dts.cmake
Parsing /home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello/Kconfig
Loaded configuration '/home/user/golioth-firmware-sdk/zephyr/boards/x86/qemu_x86/qemu_x86_defconfig'
Merged configuration '/home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello/prj.conf'
Merged configuration '/home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello/boards/qemu_x86.conf'
Configuration saved to '/home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello/build/zephyr/.config'
Kconfig header saved to '/home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello/build/zephyr/include/generated/autoconf.h'
-- Found GnuLd: /home/user/zephyr-sdk-0.16.5-1/x86_64-zephyr-elf/bin/../lib/gcc/x86_64-zephyr-elf/12.2.0/../../../../x86_64-zephyr-elf/bin/ld.bfd (found version "2.38") 
-- The C compiler identification is GNU 12.2.0
-- The CXX compiler identification is GNU 12.2.0
-- The ASM compiler identification is GNU
-- Found assembler: /home/user/zephyr-sdk-0.16.5-1/x86_64-zephyr-elf/bin/x86_64-zephyr-elf-gcc
CMake Warning at /home/user/golioth-firmware-sdk/zephyr/subsys/random/CMakeLists.txt:12 (message):
      Warning: CONFIG_TIMER_RANDOM_GENERATOR is not a truly random generator.
      This capability is not secure and it is provided for testing purposes only.
      Use it carefully.
-- Using ccache: /usr/bin/ccache
CMake Warning at /home/user/golioth-firmware-sdk/zephyr/CMakeLists.txt:864 (message):
  No SOURCES given to Zephyr library: drivers__entropy
  Excluding target from build.
-- Configuring done (5.5s)
CMake Error at /home/user/golioth-firmware-sdk/zephyr/cmake/modules/extensions.cmake:482 (target_sources):
  Cannot find source file:
    ../../external/bsdiff/bspatch.c
Call Stack (most recent call first):
  /home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/port/zephyr/CMakeLists.txt:42 (zephyr_library_sources)
CMake Error at /home/user/golioth-firmware-sdk/zephyr/cmake/modules/extensions.cmake:425 (add_library):
  No SOURCES given to target:
  ..__modules__lib__golioth-firmware-sdk__port__zephyr
Call Stack (most recent call first):
  /home/user/golioth-firmware-sdk/zephyr/cmake/modules/extensions.cmake:399 (zephyr_library_named)
  /home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/port/zephyr/CMakeLists.txt:27 (zephyr_library)
CMake Generate step failed.  Build files cannot be regenerated correctly.
FATAL ERROR: command exited with status 1: /usr/bin/cmake -DWEST_PYTHON=/home/user/golioth-firmware-sdk/.venv/bin/python3 -B/home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello/build -GNinja -DBOARD=qemu_x86 -S/home/user/golioth-firmware-sdk/modules/lib/golioth-firmware-sdk/examples/zephyr/hello                                                
{% endhighlight %}



-- west build: running target run
[0/1] To exit from QEMU enter: 'CTRL+a, x'[QEMU] CPU: qemu32,+nx,+pae
SeaBIOS (version zephyr-v1.0.0-0-g31d4e0e-dirty-20200714_234759-fv-az50-zephyr)
Booting from ROM..

{% highlight ruby %}
*** Booting Zephyr OS build v3.6.0 ***
[00:00:00.040,000] <inf> net_config: Initializing network
[00:00:00.040,000] <inf> net_config: IPv4 address: 192.0.2.1
[00:00:00.140,000] <inf> net_config: IPv6 address: 2001:db8::1
[00:00:00.140,000] <inf> net_config: IPv6 address: 2001:db8::1
[00:00:00.140,000] <inf> net_echo_server_sample: Run echo server
[00:00:00.140,000] <inf> net_echo_server_sample: Network connected
[00:00:00.140,000] <inf> net_echo_server_sample: Tunnel peer address not set.
[00:00:00.140,000] <inf> net_echo_server_sample: Starting...
[00:00:00.140,000] <inf> net_echo_server_sample: Waiting for TCP connection on port 4242 (IPv6)...
[00:00:00.140,000] <inf> net_echo_server_sample: Waiting for TCP connection on port 4242 (IPv4)...
[00:00:00.140,000] <inf> net_echo_server_sample: Waiting for UDP packets on port 4242 (IPv6)...
[00:00:00.140,000] <inf> net_echo_server_sample: Waiting for UDP packets on port 4242 (IPv4)...
uart:~$ net
{% endhighlight %}

